<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circle Faucet - Claim Testnet Tokens</title>
  <link rel="icon" type="image/svg+xml" href="/logo.svg">
  <link rel="manifest" href="/manifest.json">
  <meta name="description" content="Claim testnet tokens on multiple blockchain networks using Circle's faucet">
  <meta name="theme-color" content="#667eea">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-600 to-indigo-800 p-4 flex items-center justify-center">
  <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full">
    <!-- Header with Logo -->
    <div class="flex items-center justify-center mb-4">
      <img src="/primary-logo.svg" alt="Circle Logo" class="w-48 h-24">
    </div>
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-2">
      Circle Faucet
    </h1>
    <p class="text-center text-gray-600 mb-6">
      Claim testnet tokens on multiple networks
    </p>

    <!-- Developer Account CTA -->
    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
      <div class="flex items-start gap-3">
        <svg class="text-blue-600 mt-1 flex-shrink-0" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <div class="flex-1">
          <p class="text-sm text-blue-900 font-semibold mb-2">
            Need an API key? (Recommended)
          </p>
          <p class="text-sm text-blue-800 mb-3">
            Create a free Circle developer account to get your own API key and manage your own quota.
          </p>
          <a
            href="https://developers.circle.com/w3s/circle-developer-account"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
            </svg>
            Create Developer Account
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
              <polyline points="15 3 21 3 21 9"></polyline>
              <line x1="10" y1="14" x2="21" y2="3"></line>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Mode Selection -->
    <div class="grid grid-cols-2 gap-3 mb-6">
      <button
        id="btnOwnKey"
        onclick="setMode('own-key')"
        class="p-4 rounded-lg border-2 border-purple-600 bg-purple-50 transition-all"
      >
        <svg class="mx-auto mb-2 text-purple-600" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path>
        </svg>
        <div class="text-sm font-semibold">Use My API Key</div>
        <div class="text-xs text-gray-600 mt-1">You manage your quota</div>
      </button>
      
      <button
        id="btnDefault"
        onclick="setMode('default')"
        class="p-4 rounded-lg border-2 border-gray-200 hover:border-purple-300 transition-all"
      >
        <svg class="mx-auto mb-2 text-gray-400" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        <div class="text-sm font-semibold">Use Default Faucet</div>
        <div class="text-xs text-gray-600 mt-1">Password required</div>
      </button>
    </div>

    <!-- API Key Input -->
    <div id="apiKeySection" class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Your Circle API Key *
      </label>
      <input
        type="password"
        id="userApiKey"
        placeholder="TEST_API_KEY:xxx:xxx"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-600 focus:outline-none transition-colors"
      />
      <div class="mt-2 flex items-start gap-2 text-xs text-gray-600 bg-gray-50 p-3 rounded-lg">
        <svg class="flex-shrink-0 mt-0.5" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <p>
          <strong>Note:</strong> Circle enforces their own per-key limits (typically 5-10 claims per day). 
          We don't restrict your usage - use until you hit Circle's limit, then switch API keys if needed.
        </p>
      </div>
    </div>

    <!-- Password Input -->
    <div id="passwordSection" class="mb-6 hidden">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Faucet Password *
      </label>
      <input
        type="password"
        id="password"
        placeholder="Enter password"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-600 focus:outline-none transition-colors"
      />
      <p class="mt-2 text-xs text-gray-600">
        Contact admin for default faucet password. Limited to 3 claims per IP per 24h.
      </p>
    </div>

    <!-- Wallet Address -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Wallet Address *
      </label>
      <input
        type="text"
        id="address"
        placeholder="0x..."
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-600 focus:outline-none transition-colors"
      />
    </div>

    <!-- Blockchain Network -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Blockchain Network *
      </label>
      <select
        id="blockchain"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-purple-600 focus:outline-none transition-colors bg-white"
      >
        <option value="ARC-TESTNET">ARC-TESTNET</option>
        <option value="ETH-SEPOLIA">ETH-SEPOLIA</option>
        <option value="AVAX-FUJI">AVAX-FUJI</option>
        <option value="MATIC-AMOY">MATIC-AMOY</option>
        <option value="SOL-DEVNET">SOL-DEVNET</option>
        <option value="ARB-SEPOLIA">ARB-SEPOLIA</option>
        <option value="UNI-SEPOLIA">UNI-SEPOLIA</option>
        <option value="BASE-SEPOLIA">BASE-SEPOLIA</option>
        <option value="OP-SEPOLIA">OP-SEPOLIA</option>
        <option value="APTOS-TESTNET">APTOS-TESTNET</option>
      </select>
    </div>

    <!-- Token Selection -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Tokens to Claim *
      </label>
      <div class="flex gap-3 flex-wrap">
        <label class="flex items-center gap-2 px-4 py-3 border-2 border-gray-200 hover:border-purple-300 rounded-lg cursor-pointer transition-colors">
          <input type="checkbox" id="native" class="w-4 h-4 accent-purple-600">
          <span class="font-medium text-sm uppercase">Native</span>
        </label>
        <label class="flex items-center gap-2 px-4 py-3 border-2 border-purple-600 bg-purple-50 rounded-lg cursor-pointer transition-colors">
          <input type="checkbox" id="usdc" checked class="w-4 h-4 accent-purple-600">
          <img src="/usdc.svg" alt="USDC" class="w-5 h-5">
          <span class="font-medium text-sm uppercase">USDC</span>
        </label>
        <label class="flex items-center gap-2 px-4 py-3 border-2 border-gray-200 hover:border-purple-300 rounded-lg cursor-pointer transition-colors">
          <input type="checkbox" id="eurc" class="w-4 h-4 accent-purple-600">
          <img src="/eurc.svg" alt="EURC" class="w-5 h-5">
          <span class="font-medium text-sm uppercase">EURC</span>
        </label>
      </div>
    </div>

    <!-- Claim Button -->
    <button
      id="claimBtn"
      onclick="handleClaim()"
      class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition-all shadow-lg hover:shadow-xl"
    >
      Claim Tokens
    </button>

    <!-- Result -->
    <div id="result" class="hidden mt-6 p-4 rounded-lg border-2"></div>

    <!-- Footer Info -->
    <div class="mt-6 pt-6 border-t border-gray-200">
      <div class="text-xs text-gray-600 space-y-2">
        <p>
          <strong>Security:</strong> API keys are never stored. All requests are server-validated.
        </p>
        <p>
          <strong>Rate Limits:</strong> Circle enforces per-key limits (5-10 claims/day varies). 
          Default faucet: 3 claims per IP per 24h. We let Circle handle all API key limits.
        </p>
        <p>
          <strong>Need help?</strong> Visit 
          <a 
            href="https://developers.circle.com/w3s/docs" 
            target="_blank" 
            rel="noopener noreferrer"
            class="text-purple-600 hover:underline"
          >
            Circle Documentation
          </a>
        </p>
      </div>
    </div>
  </div>

  <script>
    let currentMode = 'own-key';

    function setMode(mode) {
      currentMode = mode;
      const btnOwnKey = document.getElementById('btnOwnKey');
      const btnDefault = document.getElementById('btnDefault');
      const apiKeySection = document.getElementById('apiKeySection');
      const passwordSection = document.getElementById('passwordSection');

      if (mode === 'own-key') {
        btnOwnKey.className = 'p-4 rounded-lg border-2 border-purple-600 bg-purple-50 transition-all';
        btnDefault.className = 'p-4 rounded-lg border-2 border-gray-200 hover:border-purple-300 transition-all';
        apiKeySection.classList.remove('hidden');
        passwordSection.classList.add('hidden');
      } else {
        btnOwnKey.className = 'p-4 rounded-lg border-2 border-gray-200 hover:border-purple-300 transition-all';
        btnDefault.className = 'p-4 rounded-lg border-2 border-purple-600 bg-purple-50 transition-all';
        apiKeySection.classList.add('hidden');
        passwordSection.classList.remove('hidden');
      }
    }

    async function handleClaim() {
      const resultDiv = document.getElementById('result');
      const claimBtn = document.getElementById('claimBtn');
      resultDiv.classList.add('hidden');

      // Get values
      const address = document.getElementById('address').value.trim();
      const blockchain = document.getElementById('blockchain').value;
      const native = document.getElementById('native').checked;
      const usdc = document.getElementById('usdc').checked;
      const eurc = document.getElementById('eurc').checked;
      const userApiKey = document.getElementById('userApiKey').value.trim();
      const password = document.getElementById('password').value.trim();

      // Validation
      if (!address) {
        showResult('error', 'Please enter a wallet address');
        return;
      }

      if (!native && !usdc && !eurc) {
        showResult('error', 'Please select at least one token');
        return;
      }

      if (currentMode === 'own-key' && !userApiKey) {
        showResult('error', 'Please enter your Circle API key');
        return;
      }

      if (currentMode === 'default' && !password) {
        showResult('error', 'Please enter the faucet password');
        return;
      }

      // Disable button and show loading
      claimBtn.disabled = true;
      claimBtn.innerHTML = `
        <span class="flex items-center justify-center gap-2">
          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
          Claiming...
        </span>
      `;

      try {
        const response = await fetch('/api/claim', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            address,
            blockchain,
            native,
            usdc,
            eurc,
            apiKey: currentMode === 'own-key' ? userApiKey : undefined,
            password: currentMode === 'default' ? password : undefined,
            mode: currentMode
          })
        });

        const data = await response.json();

        if (response.ok) {
          showResult('success', 'âœ… Tokens claimed successfully!', 
            data.transactionId ? `Transaction ID: ${data.transactionId}` : null
          );
          // Clear address
          document.getElementById('address').value = '';
          if (currentMode === 'default') {
            document.getElementById('password').value = '';
          }
        } else {
          showResult('error', data.message || 'Claim failed', data.error);
        }
      } catch (error) {
        showResult('error', 'Connection error', error.message);
      } finally {
        claimBtn.disabled = false;
        claimBtn.innerHTML = 'Claim Tokens';
      }
    }

    function showResult(type, message, details) {
      const resultDiv = document.getElementById('result');
      
      if (type === 'success') {
        resultDiv.className = 'mt-6 p-4 rounded-lg border-2 bg-green-50 border-green-200';
        resultDiv.innerHTML = `
          <div class="flex items-start gap-3">
            <svg class="text-green-600 flex-shrink-0 mt-1" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-green-900">${message}</p>
              ${details ? `<p class="mt-2 text-sm text-gray-700 font-mono bg-black bg-opacity-5 p-2 rounded break-all">${details}</p>` : ''}
            </div>
          </div>
        `;
      } else {
        resultDiv.className = 'mt-6 p-4 rounded-lg border-2 bg-red-50 border-red-200';
        resultDiv.innerHTML = `
          <div class="flex items-start gap-3">
            <svg class="text-red-600 flex-shrink-0 mt-1" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <div class="flex-1 min-w-0">
              <p class="font-semibold text-red-900">${message}</p>
              ${details ? `<p class="mt-2 text-sm text-gray-700 font-mono bg-black bg-opacity-5 p-2 rounded break-all">${details}</p>` : ''}
            </div>
          </div>
        `;
      }
      
      resultDiv.classList.remove('hidden');
    }

    // Update token checkbox styling on change
    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener('change', function() {
        const label = this.parentElement;
        if (this.checked) {
          label.classList.add('border-purple-600', 'bg-purple-50');
          label.classList.remove('border-gray-200');
        } else {
          label.classList.remove('border-purple-600', 'bg-purple-50');
          label.classList.add('border-gray-200');
        }
      });
    });
  </script>
</body>
</html>
